#!/bin/bash

shopt -s expand_aliases
umask 0077

pathadd() {
    if [ -d "$1" ] && [[ ":$PATH:" != *":$1:"* ]] ; then
        PATH="$1:$PATH"
    fi
}

pathadd ~/bin
pathadd ~/tcod/bin

export HOST=`hostname | cut -d. -f1`
export HOST=`python -c "print '$HOST'.lower()"`
if [ "$HOST" = "ml304zfft3" ] ; then
    HOST="rackspace"
fi
export HOST_TITLE=`python -c "print '$HOST'.title()"`

if [ "$TERM" = "linux" ] ; then
    export PS1="\u@$HOST:\W\$ "
elif [ "$TERM" = "screen" ] ; then
    export PS1="\u@$HOST:\W\$ "
else
    export PS1="\[\e]0;\u@$HOST\a\]\u@$HOST:\W\$ "
fi

export EDITOR=vi

shufl() {
    perl -MList::Util -e 'print List::Util::shuffle <>'
}

duu() {
    find . -depth 1 -not -name . -not -name .. -not -name .Trash -print0 | xargs -0 du -chs
}

Screen() {
    screen -dRS `echo $HOST | sed "s/.*/\u&/"`
}

if [ -d ~/go ] ; then
    pathadd ~/go/bin
    export GOROOT=~/go
fi

if hash go 2>/dev/null ; then
    export GOPATH=~
    lsgo() {
        find . -not -path '*/Godeps/*' -not -path '*/vendor/*' -not -name '*_GEN_*' -not -name '*.pb.go' \( -name '*.go' -or -name '*.got' -or -name '*.proto' \) | sed 's,^\./,,' | sort
    }
    vigo() {
        vim `lsgo`
    }
    golist() {
        go list ./... | grep -v /vendor/
    }
    gogo() {
        go install `golist`
    }
    gogogo() {
        go fmt `golist` && go vet `golist` && go test --timeout=1m -cpu=1,3,7 `golist` && go install `golist`
    }
    goc() {
        go test --timeout=1m -cpu=1,3,7 -coverprofile=.goc.tmp && go tool cover -html=.goc.tmp
    }
    agogo() {
        go install -a `golist`
    }
    agogogo() {
        go fmt `golist` && go vet `golist` && go test --timeout=1m -v -a -cpu=1,3,7 `golist` && go install -a `golist`
    }
    agoc() {
        go test --timeout=1m -v -a -cpu=1,3,7 -coverprofile=.goc.tmp && go tool cover -html=.goc.tmp
    }
fi

if [ -f ~/Python/bin/activate ] ; then
    export VIRTUAL_ENV_DISABLE_PROMPT=true
    source ~/Python/bin/activate
    vipy() {
        vim `find . -name '*.py' | sed 's,^\./,,' | sort`
    }
    cleanc() {
        find . -type f -name '*.py[co]' -exec rm {} \;
    }
fi

if [ -f /usr/bin/defaults ] ; then
    dock() {
        defaults write com.apple.dock tilesize -int 37 && killall Dock
    }
fi

if [ -f /usr/bin/osascript ] ; then
    gp() {
        osascript -e 'tell application "'$1'" to get bounds of front window'
    }
    sp-full() {
        osascript -e 'tell application "'$1'" to set bounds of front window to {0, 23, 1440, 851}'
    }
    sp-left() {
        osascript -e 'tell application "'$1'" to set bounds of front window to {0, 23, 650, 851}'
    }
    sp-right() {
        osascript -e 'tell application "'$1'" to set bounds of front window to {651, 23, 1440, 851}'
    }
    sp-center() {
        osascript -e 'tell application "'$1'" to set bounds of front window to {200, 90, 1238, 784}'
    }
fi
